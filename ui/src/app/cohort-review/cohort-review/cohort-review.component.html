<div appFullPage>
  <!-- Main participant navigation sidebar -->
  <div appSidebar
    #participantNav="appSidebar"
    [controller]="navBtn">
    <a class="closebtn" (click)="participantNav.close()">&times;</a>
    <a (click)="participantNav.close(); state.participant.next(null)"
      routerLink="overview"
      routerLinkActive="active">
      Overview
    </a>
    <hr />
    <a *ngFor="let participant of review.participantCohortStatuses"
      (click)="participantNav.close(); state.participant.next(participant)"
      [routerLink]="[participant.participantId]"
      routerLinkActive="active">
      {{ participant.participantId}}
      <span class="label"
        [ngClass]="statusClass(participant.status)">
        {{ statusText(participant.status) }}
      </span>
    </a>
  </div>

  <!-- Annotations & Status sidebar -->
  <div appSidebar
    #statusBar="appSidebar"
    [position]="{top: 0, right: 0}"
    [controller]="statusBtn">
    <a class="closebtn" (click)="statusBar.close()">&times;</a>
    <div class="status-wrapper">
      <app-participant-status>
      </app-participant-status>
    </div>
  </div>

  <!-- Blanket for dimming the background when a sidebar is open -->
  <div class="blanket" [class.blanket-active]="participantNav.isOpen || statusBar.isOpen"></div>

  <!-- Main content area for the Cohort Review Sub-application -->
  <div class="cohort-review-main"
    [style.margin-left]="participantNav.isOpen ? '300px' : 0"
    [style.margin-right]="statusBar.isOpen ? '300px' : 0">
    <button #navBtn
      (click)="participantNav.open(); $event.stopPropagation()">
      Subjects
    </button>
    <button #statusBtn
      (click)="statusBar.open(); $event.stopPropagation()">
      Status
    </button>
    <router-outlet></router-outlet>
  </div>

  <!-- Cohort creation modal -->
  <clr-modal
    #createCohortModal
    [clrModalStaticBackdrop]="false"
    [clrModalSize]="'lg'">
    <h3 class="modal-title">Generate Review Set</h3>

    <div class="modal-body">
      <p> Cohort {{ cohort.name }} has {{ review.matchedParticipantCount }}
        participants for possible review.  How many would you like to review?
        (max 10000)
      </p>
      <form [formGroup]="reviewParamForm" (ngSubmit)="createReview()">
        <label>Cohort Review Parameters</label>
        <section class="form-block">
          <div class="form-group">
            <label for="numParticipants" class="required">Number of Participants</label>
            <label
              role="tooltip"
              class="tooltip tooltip-validation tooltip-sm"
              [class.invalid]="numParticipants.invalid && (numParticipants.dirty || numParticipants.touched)">
              <input
                id="numParticipants"
                formControlName="numParticipants"
                type="number"
                min="0" max="maxParticipants">
              <span
                *ngIf="numParticipants.errors?.required"
                class="tooltip-content">
                You must select a number of participants for review.
              </span>
              <span
                *ngIf="numParticipants.errors?.min"
                class="tooltip-content">
                You must review more than zero participants.
              </span>
              <span
                *ngIf="numParticipants.errors?.max"
                class="tooltip-content">
                You may only review up to {{ maxParticipants }}.
              </span>
            </label>
          </div>
        </section>
      </form>
    </div>

    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-outline"
        (click)="cancelReview()">
        Cancel
      </button>

      <button
        type="button"
        class="btn btn-primary"
        [disabled]="reviewParamForm.invalid"
        [clrLoading]="buttonBusy"
        (click)="createReview()">
        Save Review Set
      </button>
    </div>
  </clr-modal>
</div>
