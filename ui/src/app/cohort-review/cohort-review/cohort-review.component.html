<div appFullPage>
  <div *ngIf="loading" class="spinner">Loading...</div>

  <!-- Main subject navigation sidebar -->
  <div appSidebar
    #subjectNav="appSidebar"
    [controller]="navBtn">
    <a class="closebtn" (click)="subjectNav.close()">&times;</a>
    <a (click)="subjectNav.close()"
      routerLink="overview"
      routerLinkActive="active">
      Overview
    </a>
    <hr />
    <a *ngFor="let subject of review.participantCohortStatuses"
      (click)="subjectNav.close()"
      [routerLink]="[subject.participantId]"
      routerLinkActive="active">
      {{ subject.participantId}}
      <span class="label"
        [ngClass]="statusClass(subject.status)">
        {{ statusText(subject.status) }}
      </span>
    </a>
  </div>

  <!-- Annotations & Status sidebar -->
  <div appSidebar
    #statusBar="appSidebar"
    [position]="{top: 0, right: 0}"
    [controller]="statusBtn">
    <a class="closebtn" (click)="statusBar.close()">&times;</a>
    <div class="form-group">
      <label>Participant Review Status</label>
      <div class="radio">
        <input type="radio" name="subjectStatus" id="subject-included-status"
          [formControl]="subjectStatus"
          value="CohortStatus.INCLUDED">
        <label for="subject-included-status">Include</label>
      </div>
      <div class="radio">
        <input type="radio" name="subjectStatus" id="subject-excluded-status"
          [formControl]="subjectStatus"
          value="CohortStatus.EXCLUDED">
        <label for="subject-excluded-status">Exclude</label>
      </div>
      <div class="radio">
        <input type="radio" name="subjectStatus" id="subject-needs-further-review"
          [formControl]="subjectStatus"
          value="CohortStatus.NEEDSFURTHERREVIEW">
        <label for="subject-needs-further-review">Needs Further Review</label>
      </div>
      <div class="radio">
        <input type="radio" name="subjectStatus" id="subject-unreviewed"
          [formControl]="subjectStatus"
          value="CohortStatus.NOTREVIEWED">
        <label for="subject-unreviewed">Unreviewed</label>
      </div>
    </div>
  </div>

  <!-- Blanket for dimming the background when a sidebar is open -->
  <div class="blanket" [class.blanket-active]="subjectNav.isOpen || statusBar.isOpen"></div>

  <!-- Main content area for the Cohort Review Sub-application -->
  <div class="cohort-review-main"
    [style.margin-left]="subjectNav.isOpen ? '300px' : 0"
    [style.margin-right]="statusBar.isOpen ? '300px' : 0">
    <button #navBtn
      (click)="subjectNav.open(); $event.stopPropagation()">
      Subjects
    </button>
    <button #statusBtn
      (click)="statusBar.open(); $event.stopPropagation()">
      Status
    </button>
    <router-outlet></router-outlet>
  </div>

  <!-- Cohort creation modal -->
  <clr-modal
    #createCohortModal
    [clrModalStaticBackdrop]="false"
    [clrModalSize]="'lg'">
    <h3 class="modal-title">Generate Review Set</h3>

    <div class="modal-body">
      <p> Cohort {{ cohort.name }} has {{ review.matchedParticipantCount }}
        participants for possible review.  How many would you like to review?
        (max 10000)
      </p>
      <form [formGroup]="reviewParamForm" (ngSubmit)="createReview()">
        <label>Cohort Review Parameters</label>
        <section class="form-block">
          <div class="form-group">
            <label for="numParticipants" class="required">Number of Participants</label>
            <label
              role="tooltip"
              class="tooltip tooltip-validation tooltip-sm"
              [class.invalid]="numParticipants.invalid && (numParticipants.dirty || numParticipants.touched)">
              <input
                id="numParticipants"
                formControlName="numParticipants"
                type="number"
                min="0" max="maxParticipants">
              <span
                *ngIf="numParticipants.errors?.required"
                class="tooltip-content">
                You must select a number of participants for review.
              </span>
              <span
                *ngIf="numParticipants.errors?.min"
                class="tooltip-content">
                You must review more than zero participants.
              </span>
              <span
                *ngIf="numParticipants.errors?.max"
                class="tooltip-content">
                You may only review up to {{ maxParticipants }}.
              </span>
            </label>
          </div>
        </section>
      </form>
    </div>

    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-outline"
        (click)="cancelReview()">
        Cancel
      </button>

      <button
        type="button"
        class="btn btn-primary"
        [disabled]="reviewParamForm.invalid"
        (click)="createReview()">
        Save Review Set
      </button>
    </div>
  </clr-modal>
</div>
