<app-top-box>
  <div class="concept-set-header">
    <clr-dropdown class="action-menu-dropdown">
      <!-- TODO: Once clone is added to the menu, never disable the dropdown. -->
      <button type="button" class="resource-menu" [disabled]="!canEdit" clrDropdownTrigger>
        <clr-icon shape="ellipsis-vertical" class="ellipsis-vertical"></clr-icon>
      </button>
      <clr-dropdown-menu *clrIfOpen>
        <button clrDropdownItem class="action-item action-edit"
            (click)="editing=true"
            [class.disabled]="!canEdit"
            [disabled]="!canEdit">
          <clr-icon shape="pencil"></clr-icon>
          Edit
        </button>
        <button clrDropdownItem class="action-item action-delete"
            (click)="confirmDeleting=true"
            [class.disabled]="!canEdit"
            [disabled]="!canEdit">
          <clr-icon shape="trash"></clr-icon>
          Delete
        </button>
      </clr-dropdown-menu>
    </clr-dropdown>
    <div class="concept-set-details">
      <div class="concept-set-name">
        <h2 *ngIf="!editing">{{conceptSet.name}}</h2>
        <input *ngIf="editing" class="edit-name" type="text" autofocus [(ngModel)]="editName">
        <button *ngIf="!editing" class="btn btn-icon edit-button" [disabled]="!canEdit"
            (mouseover)="editHover=true" (mouseleave)="editHover=false" (click)="editing=true">
          <app-edit-icon [editHover]="editHover"></app-edit-icon>
        </button>
      </div>
      <p *ngIf="!editing">{{conceptSet.description}}</p>
      <textarea *ngIf="editing" class="edit-description" type="text" [(ngModel)]="editDescription"></textarea>
      <div *ngIf="editing" class="edit-buttons">
        <span role="tooltip" aria-haspopup="true" class="tooltip tooltip-sm tooltip-top-left">
          <button type="button" class="btn btn-primary submit-edit-button"
              (click)="submitEdits()" [clrLoading]="editSubmitting" [disabled]="!validateEdits()">
            Save
          </button>
          <span *ngIf="!editName" class="tooltip-content">A name is required</span>
        </span>
        <button type="button" class="btn btn-outline cancel-edit-button" (click)="editing=false">Cancel</button>
      </div>
      <div class="concept-set-tags">
        <span>Participant count: {{conceptSet.participantCount}}</span>
        <span>Domain: {{conceptSet.domain | titlecase}}</span>
      </div>
      <!-- The empty state. -->
      <button *ngIf="!conceptSet.concepts?.length" class="btn nav-button"
              routerLink="/workspaces/{{wsNamespace}}/{{wsId}}/concepts"
              [queryParams]="{domain: conceptSet.domain}" routerLinkActive="active">
        <clr-icon shape="search" class="icon search-icon"></clr-icon>
        Add concepts to set
      </button>
    </div>
    <div class="concept-set-navigation" style="display: inline-block;">
      <button class="btn nav-button" routerLinkActive="active"
          routerLink="/workspaces/{{wsNamespace}}/{{wsId}}/concepts"
          [queryParams]="{domain: conceptSet.domain}">
        <clr-icon shape="search" class="icon search-icon"></clr-icon>
        Add concepts to set
      </button>
      <button class="btn nav-button" routerLinkActive="active"
          routerLink="/workspaces/{{wsNamespace}}/{{wsId}}/concepts/sets">
        <clr-icon shape="grid-view" class="icon search-icon"></clr-icon>
        Return to concept sets
      </button>
    </div>
  </div>
  <div *ngIf="conceptSet.concepts?.length" class="concept-table-wrap">
    <app-concept-table [concepts]="conceptSet.concepts" [placeholderValue]="'No Concepts Found'"></app-concept-table>
  </div>
  <app-sliding-fab [disable]="disableRemoveFab" [expanded]="'Remove from set'" (submit)="removing=true">
    <clr-icon shape="trash" class="remove-icon"></clr-icon>
  </app-sliding-fab>
</app-top-box>

<app-confirm-delete-modal [resourceType]="'Concept Set'"
                          [resource]=conceptSet
                          [receiveDelete]=receiveDelete.bind(this)
                          [deleting]="confirmDeleting"
                          [closeFunction]="closeConfirmDelete.bind(this)">
</app-confirm-delete-modal>

<clr-modal [(clrModalOpen)]="removing" [clrModalSize]="'md'">
  <div class="modal-title">
    <div *ngIf="removing" class="modal-title-text">
      Are you sure you want to remove {{selectedConceptsCount}} {{selectedConceptsCount > 1 ? 'concepts' : 'concept'}} from this set?
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline" (click)="removing=false">Cancel</button>
    <button type="button" class="btn btn-primary confirm-remove-btn" (click)="removeConcepts()"
            [clrLoading]="removeSubmitting" [disabled]="removeSubmitting">Remove Concepts</button>
  </div>
</clr-modal>
