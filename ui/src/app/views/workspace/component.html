<div class="workspace-container">
  <app-top-box style="width: 78%">
    <div class="padding-wrapper">
      <div class="main-body">
        <div style="display: flex; flex-direction: row">
          <h2 class="greeting" style="width: 200px; padding-left: .5%">
            Actions
            <app-tooltip>
                <div class="tooltip-header">Create a new Cohort</div>
                <div class="tooltip-label">A “Cohort” is a group of participants you are interested in researching.
                  <br>The cohort builder allows you to create and review cohorts and annotate participants in your study group.
                </div>
                <div class="tooltip-header">Create a new Notebook</div>
                <div class="tooltip-label">A Notebook is a computational environment
                  where you can analyze data with basic programming knowledge
                  in R or Python.
                </div>
            </app-tooltip>
          </h2>
          <h2 class="greeting" style="margin-left: 2.3rem; font-size: 16px">
            Recently Modified
            <app-tooltip>
              <div class="tooltip-label">This section shows the items in your workspace sorted by their last modified date.
              </div>
            </app-tooltip>
          </h2>
        </div>
        <div style="display: flex; flex-direction: row; align-items: center; width: 100%">
          <div style="width: 200px; margin-right: 1rem;">
            <div role="tooltip" aria-haspopup="true" class="tooltip tooltip-md tooltip-top-right">
              <span *ngIf="!writePermission" class="tooltip-content">Write permission required to create cohorts</span>
              <div class="card add-card" [ngClass]="{'disabled' : !writePermission}" (click)="!writePermission || buildCohort()">
                <div class="create-text">
                  Create a <br/>New Cohort
                  <clr-icon shape="plus-circle" class="plus-circle"></clr-icon>
                </div>
              </div>
            </div>
            <div role="tooltip" aria-haspopup="true" class="tooltip tooltip-md tooltip-top-right">
              <span *ngIf="!writePermission" class="tooltip-content">Write permission required to create notebooks</span>
              <div class="card add-card" [ngClass]="{'disabled' : !writePermission }" style="margin-top: 13px;" (click)="!writePermission || newNotebook()">
                <div class="create-text">
                  Create a<br/>New Notebook
                  <clr-icon shape="plus-circle" class="plus-circle"></clr-icon>
                </div>
              </div>
            </div>
          </div>
          <div style="flex-grow: 3; min-width: 0;">
            <app-recent-work></app-recent-work>
          </div>
        </div>
        <div style="padding-top: 1rem;">
          <h4 class="subheader">Research Purpose
            <span role="tooltip"
                  aria-haspopup="true" class="tooltip tooltip-sm tooltip-top-right">
          <button [disabled]="!ownerPermission"
                  [class.disabled]="!ownerPermission"
                  routerLink="/workspaces/{{workspace.namespace}}/{{workspace.id}}/edit"
                  routerLinkActive="active" class="action-item">
            <clr-icon shape="pencil" class="icon"></clr-icon>
          </button>
          <span *ngIf="!ownerPermission" class="tooltip-content">You must be a workspace owner to edit the Research Purpose</span>
        </span>
            <app-tooltip [direction]="'top-right'">
              <div class="tooltip-label">When you created your Workspace, you were required to describe your research purpose. This will be posted on the publicly available All of Us website. Here you can edit your research purpose and keep it up to date.
              </div>
            </app-tooltip>
          </h4>
          <div class="research-purpose-items">
            <div class="column">
              <div class="research-purpose-item" *ngFor="let researchPurposeDescription of leftResearchPurposes">
                {{researchPurposeDescription}}
              </div>
            </div>
            <div class="column">
              <div class="research-purpose-item" *ngFor="let researchPurposeDescription of rightResearchPurposes">
                {{researchPurposeDescription}}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </app-top-box>
  <div class="right-sidebar">
    <div>
      <h6 class="collaborator-text">
        Collaborators:
        <app-tooltip [direction]="'left'">
          <div class="tooltip-label">
            Here you can add and see collaborators with whom you share your workspace.
            <div style="padding-top: 0.5rem">
              Collaborators can be assigned different permissions within your Workspace.
              <ul>
                <li style="list-style-position: outside; margin-left: 0.6rem;">A <span style="text-decoration: underline;">Reader</span> can view your notebooks, but not make edits, deletes or share contents of the Workspace.</li>
                <li style="list-style-position: outside; margin-left: 0.6rem;">A <span style="text-decoration: underline;">Writer</span> can view, edit and delete content in the Workspace but not share the Workspace with others.</li>
                <li style="list-style-position: outside; margin-left: 0.6rem;">An <span style="text-decoration: underline;">Owner</span> can view, edit, delete and share contents in the Workspace.</li>
              </ul>
            </div>
          </div>
        </app-tooltip>
      </h6>
      <span role="tooltip" aria-haspopup="true" class="tooltip tooltip-md tooltip-top-left">
        <button class="btn btn-secondary btn-short" [disabled]="!ownerPermission" (click)="share()">Share</button>
        <span *ngIf="!ownerPermission" class="tooltip-content">
          Owner access is required to share the workspace.
        </span>
      </span>
    </div>
      <div *ngFor="let user of workspace.userRoles">
        <div>{{user.role}}: {{user.email}}</div>
      </div>
    <h6>
      Workspace Information
      <app-tooltip [direction]="'top-left'">
        <div class="tooltip-header"> Dataset</div>
        <div class="tooltip-label">
          The version of the dataset used by this workspace is displayed here
        </div>
        <div class="tooltip-header" style="padding-top: 0.3rem"> Creation date</div>
        <div class="tooltip-label">The date you created your Workspace.</div>
        <div class="tooltip-header" style="padding-top: 0.3rem"> Last Updated</div>
        <div class="tooltip-label">The date this workspace was last updated.</div>
        <div class="tooltip-header" style="padding-top: 0.3rem"> Access level</div>
        <div class="tooltip-label">
          To make sure data is accessed only by authorized users, users can request and be granted access to data access tiers
          within the All of Us Research Program. Currently there are 3 tiers  - “Public”, “Registered” and “Controlled”.
        </div>
      </app-tooltip>
    </h6>
    <div class="information-area">
      <div class="information-box">
        <div class="information-header">
          Dataset
        </div>
        <div class="information-body cdr-version-text">
          {{cdrVersion?.name || 'Loading...'}}
        </div>
      </div>
      <div class="information-box">
        <div class="information-header">
          Creation Date
        </div>
        <div class="information-body">
          {{workspaceCreationTime}}
        </div>
      </div>
      <div class="information-box">
        <div class="information-header">
          Last Updated
        </div>
        <div class="information-body">
          {{workspaceLastModifiedTime}}
        </div>
      </div>
      <div class="information-box">
        <div class="information-header">
          Data Access Level
        </div>
        <div class="information-body">
          {{workspace.dataAccessLevel | titlecase}}
        </div>
      </div>
    </div>
    <a (click)="googleBucketModal = true">
      Google Bucket
    </a>
  </div>
</div>
<app-workspace-share [workspace]="workspace"
                     [accessLevel]="accessLevel"
                     [onClose]="closeShare.bind(this)"
                     [userEmail]="username"
                     [sharing]="sharing"></app-workspace-share>
<clr-modal [(clrModalOpen)]="googleBucketModal">
  <h3 class="modal-title">Note</h3>
  <div class="modal-body">It is All of Us data use policy that researchers should not make copies of or download
    individual-level data (including taking screenshots or other means of viewing individual-level data) outside of
    the All of Us research environment without approval from All of Us Resource Access Board (RAB).<br>
    Notebooks should rarely be downloaded directly from Google Cloud Console, as output cells in Notebooks may
    contain sensitive individual level data.
  </div>
  <div class="modal-footer">`
    <button type="button" class="btn btn-secondary" (click)="googleBucketModal = false">Cancel</button>
      <a  class="btn btn-alink" (click)="openGoogleBucket()">
        Continue
      </a>
  </div>
</clr-modal>
<clr-modal [(clrModalOpen)]="notebookError">
  <h3 class="modal-title">Error:</h3>
  <div class="modal-body">Could not fetch notebooks from workspace. Please <a (click)="submitNotebooksLoadBugReport()">submit a bug report.</a></div>
  <div class="modal-footer">
    <button type="button" class="btn btn-primary" (click)="notebookError = false">Ok</button>
  </div>
</clr-modal>
<app-bug-report *ngIf="bugReportOpen"
                [bugReportDescription]="bugReportDescription"
                [onClose]="closeBugReport"></app-bug-report>
<app-new-notebook-modal *ngIf="creatingNotebook"
  [workspace]="workspace"
  [existingNotebooks]="notebookList"
  [onClose]="closeNotebookModal"
></app-new-notebook-modal>
