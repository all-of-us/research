<div *ngIf="!notFound else notFoundMessage">
  <div *ngIf="!workspaceLoading; else workspacePageLoading" style="display: flex;">
    <h2>{{workspace.name}}</h2>
    <div class="btn-group btn-primary-outline permissions-group">
      <button (mouseover)="editHover=true" (mouseleave)="editHover=false"
          [disabled]="!writePermission" (click)="edit()"
          class="btn btn-icon btn-primary-outline tooltip tooltip-sm">
        <app-edit-icon [editHover]="editHover"></app-edit-icon>
        <span class="tooltip-content">Edit Workspace</span>
      </button>
      <button (mouseover)="shareHover=true" (mouseleave)="shareHover=false"
          (click)="share()" class="btn btn-icon btn-primary-outline tooltip tooltip-sm">
        <app-share-icon [shareHover]="shareHover"></app-share-icon>
        <span class="tooltip-content">Share Workspace</span>
      </button>
      <button (mouseover)="cloneHover=true" (mouseleave)="cloneHover=false"
              (click)="clone()" class="btn btn-icon btn-primary-outline tooltip tooltip-sm">
        <!-- TODO(calbach): Check whether we have the real asset available. -->
        <clr-icon shape="copy"></clr-icon>
        <span class="tooltip-content">Clone Workspace</span>
      </button>
      <button (mouseover)="trashHover=true" (mouseleave)="trashHover=false"
          [disabled]="!ownerPermission"
          class="btn btn-icon btn-danger-outline btn-deleting tooltip tooltip-sm"
          (click)="delete()" [clrLoading]="deleting">
        <app-trash-icon [trashHover]="trashHover"></app-trash-icon>
        <span class="tooltip-content">Delete Workspace</span>
      </button>
    </div>
  </div>
  <ng-template #workspacePageLoading>
    <div class="loading-area">
      <span class="spinner spinner-md" style="padding-top: 1rem"></span>
      <span class="loading-text">Loading...</span>
    </div>
  </ng-template>
  <div *ngIf="!workspaceLoading;" class="description-text">
    {{workspace.description}}
  </div>
  <div class="area-block">
    <h3>CDR Version</h3>
    <div class="indented">
      <p *ngIf="!workspaceLoading;" class="cdr-text">
        {{workspace.cdrVersionId}}
      </p>
    </div>
  </div>
  <div class="area-block">
    <div class="table-header">
      <h3 class="table-header-descriptor">Cohorts</h3>
      <a class="btn btn-link" routerLink="{{document.location.pathname}}/cohorts/build">Add a Cohort</a>
    </div>
    <div class="indented">
      <clr-datagrid [clrDgLoading]="cohortsLoading">
        <clr-dg-column [clrDgField]="'cohort.name'" [clrDgSortBy]="cohortNameComparator" [style.width.%]="25">
          Name
          <clr-dg-string-filter [clrDgStringFilter]="cohortNameFilter"></clr-dg-string-filter>
        </clr-dg-column>
        <clr-dg-column [clrDgField]="'cohort.description'" [clrDgSortBy]="cohortDescriptionComparator" [style.width.%]="50">
          Description
          <clr-dg-string-filter [clrDgStringFilter]="cohortDescriptionFilter"></clr-dg-string-filter>
        </clr-dg-column>
        <clr-dg-column [style.width.%]="25">Created Date</clr-dg-column>
        <clr-dg-placeholder>No cohorts found in this workspace.</clr-dg-placeholder>
        <clr-dg-row *clrDgItems="let cohort of cohortList" [clrDgItem]="cohort" class="table-row cohort-table-row">
          <clr-dg-action-overflow>
            <button class="action-item"
              routerLink="{{document.location.pathname}}/cohorts/build"
              [queryParams]="{criteria: cohort.criteria}">
              <clr-icon shape="copy"></clr-icon>
              Clone
            </button>
            <button class="action-item"
              routerLink="{{document.location.pathname}}/cohorts/{{cohort.id}}/edit">
              <clr-icon shape="pencil"></clr-icon>
              Edit
            </button>
            <button class="action-item"
              routerLink="{{document.location.pathname}}/cohorts/{{cohort.id}}/review">
              <clr-icon shape="grid-view"></clr-icon>
              Review
            </button>
          </clr-dg-action-overflow>
          <clr-dg-cell>{{cohort.name}}</clr-dg-cell>
          <clr-dg-cell>{{cohort.description}}</clr-dg-cell>
          <clr-dg-cell>{{cohort.creationTime | date:'medium'}}</clr-dg-cell>
        </clr-dg-row>
      </clr-datagrid>
    </div>
  </div>
  <clr-modal [(clrModalOpen)]="cohortsError">
    <h3 class="modal-title">Error:</h3>
    <div class="modal-body">Could not fetch cohorts from workspace.</div>
    <div class="modal-footer">
      <button type="button" class="btn btn-primary" (click)="cohortsError = false">Ok</button>
    </div>
  </clr-modal>

  <clr-modal [(clrModalOpen)]="clusterPulled">
    <h3 class="modal-title">Cluster Created:</h3>
    <div class="modal-body">Your notebook cluster is ready. Would you like to enter the cluster?</div>
    <div class="modal-footer">
      <button type="button" class="btn btn-primary" (click)="openCluster()">Ok</button>
      <button type="button" class="btn btn-primary" (click)="cancelCluster()">Cancel</button>
    </div>
  </clr-modal>
  <div class="area-block">
    <div class="table-header">
      <h3 class="table-header-descriptor">Notebooks</h3>
      <button class="btn" (click)="launchNotebook()">Launch Notebook Server</button>
      <button class="btn" (click)="createAndLaunchNotebook()">
        <div *ngIf="!clusterLoading; else clusterCreateLoading">Create Notebook Server</div>
        <ng-template #clusterCreateLoading>
          <div>
            <span class="spinner spinner-sm"></span>
            <span class="loading-text">Creating Notebook Server...</span>
          </div>
        </ng-template>
      </button>
      <button class="btn" (click)="killNotebook()">Delete Notebook Server</button>
    </div>
    <div class="indented">
      <button class="btn" (click)="localizeNotebooks(notebookList)"
              [ngClass]="{disabled: !enablePushNotebookBtn}">Push To Notebook Server</button>
      <div class="alert {{alertCategory}}" *ngIf="showAlerts">
        <div class="alert-items">
          <div class="alert-item static">
            <div class="alert-icon-wrapper">
              <clr-icon class="alert-icon" shape="check-circle"></clr-icon>
            </div>
            <span class="alert-text">{{alertMsg}}</span>
          </div>
        </div>
      </div>
      <clr-datagrid [clrDgLoading]="notebooksLoading">
        <clr-dg-column><input type="checkbox" (change)="selectAllNoteBooks()" [(ngModel)]="checkColumnNotebook"/></clr-dg-column>
        <clr-dg-column [clrDgField]="'notebook.name'" [clrDgSortBy]="notebookNameComparator">
          Name
          <clr-dg-string-filter [clrDgStringFilter]="notebookNameFilter"></clr-dg-string-filter>
        </clr-dg-column>
        <clr-dg-column>Path</clr-dg-column>
        <clr-dg-placeholder>No notebooks found in this workspace.</clr-dg-placeholder>
        <clr-dg-row *clrDgItems="let notebook of notebookList" [clrDgItem]="notebook" class="table-row notebook-table-row">
          <clr-dg-cell><input type="checkbox" (change)="selectANotebook(notebook)" [(ngModel)]="notebook.selected"/></clr-dg-cell>
          <clr-dg-cell>{{notebook.name}}</clr-dg-cell>
          <clr-dg-cell>{{notebook.path}}</clr-dg-cell>
        </clr-dg-row>
      </clr-datagrid>
    </div>
  </div>
  <clr-modal [(clrModalOpen)]="notebookError">
    <h3 class="modal-title">Error:</h3>
    <div class="modal-body">Could not fetch notebooks from workspace.</div>
    <div class="modal-footer">
      <button type="button" class="btn btn-primary" (click)="notebookError = false">Ok</button>
    </div>
  </clr-modal>
</div>
<!-- TODO: Factor out to component -->
<ng-template #notFoundMessage>
  <h3>
    Workspace {{route.snapshot.params['ns']}}/{{route.snapshot.params['wsid']}} could not be found.
  </h3>
</ng-template>
