#!/usr/bin/env ruby

require 'fileutils'
require_relative "../../aou-utils/workbench"

def build_snippets_menu()
  tmpl = File.read("aou-snippets-menu.js.template")
  tmpl = "/* " + ("=" * 20) +
         " This file is autogenerated, DO NOT MODIFY MANUALLY " +
         ("=" * 20) + " */\n" + tmpl
  tmpl.sub! "{{PY_MENU_JSON}}", File.read("py-snippets-menu.json").chomp
  tmpl.sub! "{{R_MENU_JSON}}", File.read("r-snippets-menu.json").chomp
  FileUtils.mkdir_p "generated"
  File.write("generated/aou-snippets-menu.js", tmpl)
end

Common.register_command({
  :invocation => "build-snippets-menu",
  :description => "Builds the templated snippets menu Jupyter extension",
  :fn => ->() { build_snippets_menu }
})

Workbench.handle_argv_or_die(__FILE__)
