<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

  <changeSet author="biopete" id="changelog-11.0"  runAlways="true" >
    <validCheckSum>ANY</validCheckSum>
    <preConditions onFail="MARK_RAN">
      <tableExists tableName="ACHILLES_analysis" schemaName="cdr"></tableExists>
    </preConditions>
    <dropTable tableName="ACHILLES_analysis"/>
  </changeSet>

  <changeSet author="biopete" id="changelog-11.1" runAlways="true" >
    <validCheckSum>ANY</validCheckSum>
    <preConditions>
      <not>
        <tableExists tableName="ACHILLES_analysis" schemaName="cdr"></tableExists>
      </not>
    </preConditions>

    <createTable tableName="ACHILLES_analysis">
      <column name="analysis_id" type="BIGINT">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="analysis_name" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="stratum_1_name" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="stratum_2_name" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="stratum_3_name" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="stratum_4_name" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="stratum_5_name" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="chartType" type="VARCHAR(20)">
        <constraints nullable="true"/>
      </column>
      <column name="dataType" type="VARCHAR(20)">
        <constraints nullable="true"/>
      </column>
    </createTable>

  </changeSet>


  <changeSet author="biopete" id="changelog-11.2" runAlways="true">
    <validCheckSum>ANY</validCheckSum>
    <loadData tableName="ACHILLES_analysis" file="csv/ACHILLES_analysis.csv" encoding="UTF-8" quotchar='"'>
      <column name="analysis_id" type="NUMERIC"/>
      <column name="analysis_name" type="STRING"/>
      <column name="stratum_1_name" type="STRING"/>
      <column name="stratum_2_name" type="STRING"/>
      <column name="stratum_3_name" type="STRING"/>
      <column name="stratum_4_name" type="STRING"/>
      <column name="stratum_5_name" type="STRING"/>
      <column name="chartType" type="STRING"/>
      <column name="dataType" type="STRING"/>
    </loadData>

  </changeSet>

  <changeSet author="biopete" id="changelog-11.3" runAlways="true">
    <validCheckSum>ANY</validCheckSum>
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="ACHILLES_results" schemaName="cdr"></tableExists>
      </not>
    </preConditions>

    <createTable tableName="ACHILLES_results">
      <column name="analysis_id" type="BIGINT">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="stratum_1" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="stratum_2" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="stratum_3" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="stratum_4" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="stratum_5" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="count_value" type="BIGINT">
        <constraints nullable="true"/>
      </column>
    </createTable>

  </changeSet>

  <changeSet author="biopete" id="changelog-11.4" runAlways="true">
    <validCheckSum>ANY</validCheckSum>
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="ACHILLES_results_dist" schemaName="cdr"></tableExists>
      </not>
    </preConditions>

    <createTable tableName="ACHILLES_results_dist">
      <column name="analysis_id" type="BIGINT">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="stratum_1" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="stratum_2" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="stratum_3" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="stratum_4" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="stratum_5" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="count_value" type="BIGINT">
        <constraints nullable="true"/>
      </column>
      <column name="min_value" type="BIGINT">
        <constraints nullable="true"/>
      </column>
      <column name="max_value" type="BIGINT">
        <constraints nullable="true"/>
      </column>
      <column name="avg_value" type="BIGINT">
        <constraints nullable="true"/>
      </column>
      <column name="stdev_value" type="BIGINT">
        <constraints nullable="true"/>
      </column>
      <column name="median_value" type="BIGINT">
        <constraints nullable="true"/>
      </column>
      <column name="p10_value" type="BIGINT">
        <constraints nullable="true"/>
      </column>
      <column name="p25_value" type="BIGINT">
        <constraints nullable="true"/>
      </column>
      <column name="p75_value" type="BIGINT">
        <constraints nullable="true"/>
      </column>
      <column name="p90_value" type="BIGINT">
        <constraints nullable="true"/>
      </column>
    </createTable>
  </changeSet>
</databaseChangeLog>
