<div class="survey-view">

  <div class="row">

    <div class="col-xs-12">
      <div class="page-header">
        <div *ngIf="survey && survey.conceptId">
          <h2> {{survey.domainDisplay}} Survey Module ({{survey.conceptId}}) </h2>
          <h4 class="view-sub-title">{{survey.domainDesc}}. </h4>
        </div>
      </div>
    </div>

  </div>

  <div class="row">

    <div class="col-md-4 col-sm-6 col-xs-12">
      <div class="white-card-box top-stat">
        <div class="row ">
          <div class="col-xs-12">
            <h5 class="box-title">
              Number Completed
            </h5>
            <div class="card-stat">
              {{survey.countValue | number }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4 col-sm-6 col-xs-12">
      <div class="white-card-box top-stat">
        <div class="row ">
          <div class="col-xs-12">
            <h5 class="box-title">
              Questions
            </h5>
            <div class="card-stat">
              <span *ngIf="loading" class="spinner spinner-md"> </span>
              <span *ngIf="!loading" >{{ surveyResult.items.length }} </span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>


  <div class="survey-results" *ngIf="resultsComplete">

    <!-- Search box is not working inside this with the survey background
      <div class="search-input-big">
        <clr-icon shape="search" class="input-icon is-info"></clr-icon>
        <input type="text" id="search-db" placeholder="Keyword Search">
      </div> -->
      <div class="row search">
        <div class="col-xs-12 flex-xs-middle search-input-full ">
          <div class="search-wrapper">
            <clr-icon shape="search" class="input-icon-absolute is-info"></clr-icon>
            <input type="text" id="search-db" placeholder="Keyword Search" [(ngModel)]="searchText" (ngModelChange)="filterResults()">
          </div>
        </div>
      </div>
      <div class="row box-sub-title"> Click on each response to view age and gender distributions</div>
      <div class="row question-result" *ngFor="let q of questions, let i = index">

        <div class=" question-card">

          <div class="row question">

            <div class="col-md-4 col-xs-12 col-sm-12">
              <div class="box-title"> Question {{i + 1}}</div>
              <div class="box-sub-title"> {{ q.conceptName}} ({{q.conceptId}}) </div>
            </div>

            <div class="col-md-8 col-xs-12 col-sm-12">
              <div class="response-dist" style="height:200px">
                <app-chart *ngIf="q.countAnalysis" [analysis]="q.countAnalysis" [chartType]="'bar'" (resultClicked)="graphAnswerClicked(item)"></app-chart>
              </div>
            </div>

          </div>

          <div class="row ">
              <div class="col-xs-12">
                <a class="toggle-link" (click)="toggleAnswer(q.conceptId)"> See Answers <clr-icon *ngIf="!showAnswer[q.conceptId]" shape="caret" dir="right"></clr-icon> <clr-icon *ngIf="showAnswer[q.conceptId]" shape="caret" dir="down"></clr-icon> </a>
              </div>
          </div>

          <div class="row answers" [hidden]="!showAnswer[q.conceptId]">

            <div class="col-sm-7 col-xs-12 answer-list">
              <div *ngFor="let a of q.countAnalysis.results"  >
                <div class="answer-text" (click)="showAnswerGraphs(q, a)" [class.answer-active]="q.selectedAnswer && q.selectedAnswer.id === a.id">
                  <label> {{a.stratum4}} </label>
                </div>
              </div>
            </div>

            <div class="col-sm-5 col-xs-12 answer-charts">
              <div class="" *ngIf="q.selectedAnswer" >
                <div class="chart-wrapper">
                  <app-chart [analysis]="q.genderAnalysis" [selectedResult]="q.selectedAnswer" [backgroundColor]="'#D9E4EA'"></app-chart>
                </div>
                <div class="chart-wrapper age">
                  <app-chart [analysis]="q.ageAnalysis" [selectedResult]="q.selectedAnswer" [backgroundColor]="'#D9E4EA'"></app-chart>
                </div>

              </div>
            </div>

          </div> <!-- end collapsible answers -->


        </div>

    </div>

  </div>

</div>
