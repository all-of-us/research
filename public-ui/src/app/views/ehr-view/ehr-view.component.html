

<div class="row flex-items-xs-middle">
  <div class="col-xs-12 col-no-gutter">
    <h2 class="title">  {{title}} </h2>
  </div>
</div>

<div class="row ">
  <div class="white-card-box flex-items-xs-middle col-md-8 col-sm-10 col-xs-11" >
    <div class="row search flex-items-xs-between">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 flex-xs-middle search-input-full">
        <div class="search-wrapper">
          <clr-icon shape="search" class="input-icon-absolute is-info"></clr-icon>
          <input type="text" id="search-db" placeholder="Keyword Search" [formControl]="searchText" autofocus>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-4 col-sm-2 col-xs-1 flex-xs-middle" *ngIf="loading" >
    <span  class="spinner spinner-lg hidden-sm-down">Loading ...</span>
    <span  class="spinner spinner-md hidden-md-up hidden-xs-down"></span>
    <span  class="spinner spinner-sm hidden-sm-up"></span>
  </div>
</div>

<!-- Top summary boxes -- only show if have results -->
<div class="row white-card-box top-stat one-row" *ngIf="items.length > 0">

    <div class="col-md-4 col-sm-6 col-xs-12">

      <div class="row">
        <h5 class="col-xs-12 box-title">
          {{dbDomain.domainDisplay}}
        </h5>
      </div>

      <div class="row">
        <div class="col-md-4 col-sm-6 col-xs-6 card-stat" >
          {{items.length}}
        </div>
        <div *ngIf="searchText.value.length > 0" class="col-md-8 col-sm-6 col-xs-6 flex-xs-middle card-text">
          matching medical concepts.
        </div>
        <div *ngIf="searchText.value.length === 0" class="col-md-8 col-sm-6 col-xs-6 flex-xs-middle card-text">
          Showing top {{items.length}} concepts for this domain.
        </div>
      </div>

    </div>

    <div class="col-md-8 col-sm-6 col-xs-12 chart-wrapper flex-xs-middle">
      <app-chart [concepts]="top10Results" [chartTitle]="'Top 10 by participant count'"
                 [pointWidth]="15" [backgroundColor]="'#D9E4EA'"> </app-chart>
    </div>

</div>




<div  class="row result-list">
  <div class="col-xs-12 col-no-gutter">
    <div class="white-card-box">

      <div class="results-grid" *ngIf="items.length > 0" >
        <div class="row" *ngIf="items.length === 1 && items[0].standardConcept != 'S' && standardConcepts.length > 0">
          <div class="col-xs-12 db-alert">
            <clr-alert  [clrAlertClosable]="false" [clrAlertType]="info">
              Note: {{items[0].vocabularyId}} {{items[0].conceptCode}} "{{items[0].conceptName}}"
              maps to Standard Vocabulary {{standardConcepts[0].vocabularyId}} {{standardConcepts[0].conceptCode}}.
              Standard vocabularies capture data across a variety of source vocabularies.
            </clr-alert>
          </div>
        </div>
        <div class="row">
          <div class="col-md-3 grid-header flex-xs-middle"> Concept Name</div>
            <div class="col-md-4 grid-header flex-xs-middle"> Synonyms </div>
          <div class="col-md-2 grid-header flex-items-xs-right"> Participants of <b> {{totalParticipants | number}}</b> </div>
          <div class="col-md-2 grid-header flex-xs-middle info-text">
            Vocabulary Code
            <clr-icon class="" shape="info-standard" class="is-solid"></clr-icon>
          </div>
          <div class="col-md-1 grid-header flex-xs-middle info-text"> View graphs </div>
        </div>
        <div class="row expandable-grid-row"
             *ngFor="let r of standardConcepts"
             [ngClass]="{'expanded-grid-row': r.expanded}" >
          <div class="col-md-3 flex-xs-middle" innerHtml=" <b>Standard</b> {{r.conceptName | highlightSearch : prevSearchText}}
            -- {{r.conceptId}}"> </div>
          <div class="col-md-4 flex-xs-middle" *ngIf="r.conceptSynonyms;else noConceptSynonyms" innerHtml="{{ r.conceptSynonyms.join(', ') | highlightSearch : prevSearchText}}"></div>
            <ng-template #noConceptSynonyms><div class="col-md-2 flex-xs-middle"></div></ng-template>
          <div class="col-md-2 flex-items-xs-right" style="margin-top: .5rem;">
            {{r.countValue | number }}
          </div>
          <div class="col-md-2 flex-xs-middle">
            {{r.vocabularyId}} {{r.conceptCode}}
          </div>
          <div class="col-md-1 flex-xs-middle">
            <button class="icon-btn" (click)="r.expanded = !r.expanded">
              <clr-icon shape="bar-chart" style="height: 1rem; width: 1rem;color: #2691D0;"></clr-icon>
            </button>
          </div>
          <div class="col-xs-12 row-expansion flex-xs-middle" *ngIf="r.expanded">
            <app-concept-charts [concept]="r" [showMeasurementGenderBins]="showMeasurementGenderBins" [showAge]="showAge" [showGender]="showGender"
                                [showSources]="showSources" [backgroundColor]="'#ECF1F4'">
            </app-concept-charts>
          </div>
        </div>
        <div class="row expandable-grid-row"
             *ngFor="let r of items, let i = index"
             [ngClass]="{'expanded-grid-row': r.expanded}" >
          <div class="col-md-3 flex-xs-middle" *ngIf="matchType === 'CONCEPT_CODE' && r.standardConcept !='S';else not_code_match" innerHtml="<b>Source</b> {{r.conceptName | highlightSearch : prevSearchText}}
            -- {{r.conceptId}}"> </div>
          <ng-template #not_code_match>
            <div class="col-md-3 flex-xs-middle" innerHtml="{{i+1}}. {{r.conceptName | highlightSearch : prevSearchText}}
            -- {{r.conceptId}}"> </div>
          </ng-template>
            <div class="col-md-4 flex-xs-middle" *ngIf="r.conceptSynonyms;else noConceptSynonyms" innerHtml="{{ r.conceptSynonyms.join(', ') | highlightSearch : prevSearchText}}"></div>
            <ng-template #noConceptSynonyms><div class="col-md-2 flex-xs-middle"></div></ng-template>
          <div class="col-md-2 flex-items-xs-right" style="margin-top: .5rem;">
            {{r.countValue | number }}
          </div>
          <div class="col-md-2 flex-xs-middle">
            {{r.vocabularyId}} {{r.conceptCode}}
          </div>
          <div class="col-md-1 flex-xs-middle">
            <button class="icon-btn" (click)="r.expanded = !r.expanded">
              <clr-icon shape="bar-chart" style="height: 1rem; width: 1rem;color: #2691D0;"></clr-icon>
            </button>
          </div>
          <div class="col-xs-12 row-expansion flex-xs-middle" *ngIf="r.expanded">
            <app-concept-charts [concept]="r" [showMeasurementGenderBins]="showMeasurementGenderBins" [showAge]="showAge" [showGender]="showGender"
                                [showSources]="showSources" [backgroundColor]="'#ECF1F4'">
            </app-concept-charts>
          </div>
        </div>
      </div>

      <div class="results-grid">
        <div class="row" *ngIf="!loading && items.length === 0">
          <div class="col-xs-12">
            <h5 class="no-results"> No results match your search. </h5>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4 col-xs-12">
            <button class="btn btn-primary btn-sm" [routerLink]="['/quick-search']"> Back to Quick Search </button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
